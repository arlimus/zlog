#!/usr/bin/env ruby
require 'zlog/cli'
require 'optparse'

options = {}
OptionParser.new do |opts|
  opts.banner = "usage: zlog [options]\n       cat my.log | zlog [options]"

  opts.on("-f", "--file FILE", "Read log from file") do |file|
    options[:file] = file
  end

  opts.on("-s", "--simple", "Print simple layout") do |v|
    options[:format] = :simple
  end

  opts.on("-n", "--named", "Print simple layout with names") do |v|
    options[:format] = :named
  end
end.parse!

cli = Zlog::CLI.new options
print_out = lambda{ |line| puts line }

if STDIN.tty?
  File::readlines( options[:file] ).each do |line|
    print_out.( cli.convert_line line )
  end
else
  cli.convert_stdin &print_out
end